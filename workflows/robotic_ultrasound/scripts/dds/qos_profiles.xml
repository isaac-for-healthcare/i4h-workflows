<?xml version="1.0"?>
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
     xsi:noNamespaceSchemaLocation="https://community.rti.com/schema/current/rti_dds_qos_profiles.xsd">

    <!-- Transport library to provide optimizations for the domain participant -->
    <qos_library name="i4h_transport">

        <!-- Optimized profile for shared memory and local network -->
        <qos_profile name="SHMEM+LAN" base_name="BuiltinQosLib::Generic.Common">
            <domain_participant_qos>
                <participant_name>
                    <name>i4h_transport</name>
                </participant_name>
                <!-- Optimizations for the the SHMEM and UDPv4 transports. -->
                <transport_builtin>
                    <mask>SHMEM | UDPv4</mask>
                    <shmem>
                        <!-- Increase the maximum message size to 4MB to reduce fragmentation.
                             4MB is large enough for a frame up to 720p resolution in a single
                             message. This can be reduced if using smaller streams, but
                             experimentation has shown that using anything larger does not
                             typically help (even if the frame size exceeds 4MB). -->
                        <message_size_max>4194304</message_size_max>
                        <received_message_count_max>10</received_message_count_max>
                        <!-- message_size_max * received_message_count_max -->
                        <receive_buffer_size>41943040</receive_buffer_size>
                    </shmem>
                    <udpv4>
                        <!-- This helps not to lose packets. Run set_socket_buffer_sizes.sh first. -->
                        <send_socket_buffer_size>4194304</send_socket_buffer_size>
                        <recv_socket_buffer_size>4194304</recv_socket_buffer_size>
                    </udpv4>
                </transport_builtin>
            </domain_participant_qos>

            <!-- Discovery-related optimizations -->
            <base_name>
                <element>BuiltinQosSnippetLib::Optimization.Discovery.Common</element>
                <element>BuiltinQosSnippetLib::Optimization.Discovery.Endpoint.Fast</element>
                <element>BuiltinQosSnippetLib::Optimization.ReliabilityProtocol.Common</element>
            </base_name>
        </qos_profile>

    </qos_library>

    <qos_library name="RoboticUltrasoundLibrary">
        
        <!-- Camera Info Profile - For camera metadata -->
        <qos_profile name="CameraInfo" base_name="BuiltinQosLib::Generic.BestEffort">
            <datawriter_qos>
                <publication_name>
                    <name>CameraInfoWriter</name>
                </publication_name>
            </datawriter_qos>
            <datareader_qos>
                <subscription_name>
                    <name>CameraInfoReader</name>
                </subscription_name>
            </datareader_qos>
        </qos_profile>

        <!-- Camera Control Profile - For camera commands -->
        <qos_profile name="CameraCtrl" base_name="BuiltinQosLib::Pattern.Streaming">
            <datawriter_qos>
                <publication_name>
                    <name>CameraCtrlWriter</name>
                </publication_name>
            </datawriter_qos>
            <datareader_qos>
                <subscription_name>
                    <name>CameraCtrlReader</name>
                </subscription_name>
            </datareader_qos>
        </qos_profile>

        <!-- Franka Info Profile - For robot state -->
        <qos_profile name="FrankaInfo" base_name="BuiltinQosLib::Generic.BestEffort">
            <datawriter_qos>
                <publication_name>
                    <name>FrankaInfoWriter</name>
                </publication_name>
            </datawriter_qos>
            <datareader_qos>
                <subscription_name>
                    <name>FrankaInfoReader</name>
                </subscription_name>
            </datareader_qos>
        </qos_profile>

        <!-- Franka Control Profile - For robot commands -->
        <qos_profile name="FrankaCtrl" base_name="BuiltinQosLib::Generic.BestEffort">
            <datawriter_qos>
                <publication_name>
                    <name>FrankaCtrlWriter</name>
                </publication_name>
            </datawriter_qos>
            <datareader_qos>
                <subscription_name>
                    <name>FrankaCtrlReader</name>
                </subscription_name>
            </datareader_qos>
        </qos_profile>

        <!-- Target Info Profile - For target tracking -->
        <qos_profile name="TargetInfo" base_name="BuiltinQosLib::Generic.BestEffort">
            <datawriter_qos>
                <publication_name>
                    <name>TargetInfoWriter</name>
                </publication_name>
            </datawriter_qos>
            <datareader_qos>
                <subscription_name>
                    <name>TargetInfoReader</name>
                </subscription_name>
            </datareader_qos>
        </qos_profile>

        <!-- Target Control Profile - For target commands -->
        <qos_profile name="TargetCtrl" base_name="BuiltinQosLib::Generic.BestEffort">
            <datawriter_qos>
                <publication_name>
                    <name>TargetCtrlWriter</name>
                </publication_name>
            </datawriter_qos>
            <datareader_qos>
                <subscription_name>
                    <name>TargetCtrlReader</name>
                </subscription_name>
            </datareader_qos>
        </qos_profile>

        <!-- USP Info Profile - For probe metadata -->
        <qos_profile name="UspInfo" base_name="BuiltinQosLib::Generic.BestEffort">
            <datawriter_qos>
                <publication_name>
                    <name>UspInfoWriter</name>
                </publication_name>
            </datawriter_qos>
            <datareader_qos>
                <subscription_name>
                    <name>UspInfoReader</name>
                </subscription_name>
            </datareader_qos>
        </qos_profile>

        <!-- USP Data Profile - For ultrasound streaming -->
        <qos_profile name="UspData" base_name="BuiltinQosLib::Pattern.Streaming">
            <datawriter_qos>
                <publication_name>
                    <name>UspDataWriter</name>
                </publication_name>
            </datawriter_qos>
            <datareader_qos>
                <subscription_name>
                    <name>UspDataReader</name>
                </subscription_name>
            </datareader_qos>
        </qos_profile>

    </qos_library>
</dds> 